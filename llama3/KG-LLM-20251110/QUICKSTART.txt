"""
EPERM System Quick Start Guide
================================

This implementation follows the architecture from the paper:
1. Subgraph Retriever - extracts relevant KG subgraph
2. Evidence Path Finder - discovers and scores reasoning paths using LLM
3. Answer Predictor - generates final answer with confidence

Installation:
--------------
cd KG-LLM-20251110
pip install -r requirements.txt

Quick Test:
-----------
python test_eperm.py

This will run automated tests against a sample knowledge graph about
Microsoft, Apple, Bill Gates, Steve Jobs, etc.

Interactive Usage:
------------------
python example_usage.py

This starts an interactive session where you can ask questions.

Configuration:
--------------
Edit config.py to change:
- LLM API settings (already configured for your local model)
- Retrieval parameters (subgraph size, hop distance)
- Path finding parameters (max paths, scoring weights)

Your Local LLM:
---------------
The system is already configured to use your local model:
- URL: http://173.61.35.162:25565/v1
- Model: qwen3-30b-a3b-instruct
- API Key: sk-local-abc

Custom Knowledge Graphs:
------------------------
Create your own KG in JSON format (see data/sample_kg.json):
{
  "entities": [
    {"id": "e1", "name": "Entity Name", "type": "Type"}
  ],
  "relations": [
    {"head": "e1", "relation": "relation_type", "tail": "e2"}
  ]
}

Then load it:
system = EPERMSystem()
system.load_knowledge_graph("path/to/your_kg.json")

Architecture Flow:
------------------
Question 
  ↓
[Subgraph Retriever]
  - Uses LLM to extract entity mentions
  - Retrieves k-hop subgraph from KG
  ↓
Subgraph
  ↓
[Evidence Path Finder]
  - Uses LLM to identify answer candidates
  - Finds reasoning paths in subgraph
  - Scores paths with LLM (relevance, confidence)
  ↓
Weighted Evidence Paths
  ↓
[Answer Predictor]
  - Uses LLM to generate final answer
  - Provides confidence score
  - Returns supporting evidence
  ↓
Answer with Confidence

Key Features:
-------------
✓ Uses your local LLM for all reasoning steps
✓ Knowledge graph storage and querying
✓ Multi-hop reasoning path discovery
✓ Evidence-based answer generation
✓ Confidence scoring
✓ Caching for efficiency
✓ Verbose logging for debugging

Example Output:
---------------
Question: Who founded Microsoft?

[Subgraph Retriever] Processing question...
  Seed entities: ['Microsoft']
  Retrieved subgraph: 5 entities, 6 relations

[Evidence Path Finder] Finding paths...
  Answer candidates: ['Bill Gates', 'Paul Allen']
  Found 3 evidence paths

[Answer Predictor] Generating answer...
  Answer: Bill Gates
  Confidence: 0.95

Answer: Bill Gates
Confidence: 0.95
Evidence paths:
  1. [Score: 0.95] Bill Gates --[founded]--> Microsoft
  2. [Score: 0.85] Paul Allen --[co-founded]--> Microsoft
"""
