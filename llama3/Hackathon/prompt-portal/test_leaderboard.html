<!DOCTYPE html>
<html>
<head>
    <title>Leaderboard API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1e293b; color: #e2e8f0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #0f172a; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .success { color: #86efac; }
        .error { color: #f87171; }
        .info { color: #93c5fd; }
    </style>
</head>
<body>
    <h1>üîç Leaderboard API Diagnostic Test</h1>
    
    <div>
        <button onclick="testAPI('lam')">Test LAM Mode</button>
        <button onclick="testAPI('manual')">Test Manual Mode</button>
        <button onclick="testAPI('driving_game')">Test Driving Game Mode</button>
        <button onclick="testAPI(null)">Test No Filter</button>
    </div>
    
    <div id="output"></div>
    
    <script>
        const BASE_URL = 'http://localhost:8000';
        
        async function testAPI(mode) {
            const output = document.getElementById('output');
            output.innerHTML = `<h3>Testing mode: ${mode || 'none'}</h3>`;
            
            try {
                // Build URL
                const params = new URLSearchParams({ limit: '50', skip: '0' });
                if (mode) params.set('mode', mode);
                const url = `${BASE_URL}/api/leaderboard/?${params.toString()}`;
                
                output.innerHTML += `<p class="info">üì° Calling: ${url}</p>`;
                
                // Make request
                const response = await fetch(url);
                const data = await response.json();
                const total = response.headers.get('X-Total-Count') || 'N/A';
                
                // Display results
                output.innerHTML += `<p class="success">‚úì Status: ${response.status}</p>`;
                output.innerHTML += `<p class="success">‚úì Total entries: ${total}</p>`;
                output.innerHTML += `<p class="success">‚úì Entries returned: ${data.length}</p>`;
                
                if (mode === 'driving_game') {
                    if (data.length === 0) {
                        output.innerHTML += `<p class="success">‚úì‚úì‚úì CORRECT! Driving Game mode returns 0 entries!</p>`;
                        output.innerHTML += `<p class="info">The API is working correctly. The problem is in the frontend.</p>`;
                    } else {
                        output.innerHTML += `<p class="error">‚úó‚úó‚úó ERROR! Should be 0 but got ${data.length} entries!</p>`;
                        output.innerHTML += `<p class="info">Sample entry:</p>`;
                        output.innerHTML += `<pre>${JSON.stringify(data[0], null, 2)}</pre>`;
                    }
                }
                
                // Show first few entries
                if (data.length > 0) {
                    output.innerHTML += `<h4>First 3 entries:</h4>`;
                    data.slice(0, 3).forEach((entry, i) => {
                        output.innerHTML += `<p><strong>${i+1}.</strong> ${entry.template_title} - Score: ${entry.new_score || entry.score}</p>`;
                    });
                }
                
            } catch (error) {
                output.innerHTML += `<p class="error">‚úó Error: ${error.message}</p>`;
                output.innerHTML += `<p class="info">Is the backend running on port 8000?</p>`;
            }
        }
        
        // Auto-test driving_game on load
        window.onload = () => {
            testAPI('driving_game');
        };
    </script>
</body>
</html>

