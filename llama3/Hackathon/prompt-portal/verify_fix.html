<!DOCTYPE html>
<html>
<head>
    <title>Verify Driving Stats Fix</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .success { border-left: 5px solid #4ade80; background: rgba(74, 222, 128, 0.1); }
        .error { border-left: 5px solid #f87171; background: rgba(248, 113, 113, 0.1); }
        .warning { border-left: 5px solid #fbbf24; background: rgba(251, 191, 36, 0.1); }
        button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        #results { margin-top: 20px; }
        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        h1 { text-align: center; margin-bottom: 30px; }
        h2 { margin-top: 0; }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <h1>üèÅ Driving Stats Fix Verification</h1>
    
    <div class="box warning">
        <h2>‚ö†Ô∏è Before Testing</h2>
        <p><strong>IMPORTANT:</strong> Clear your browser cache or this test will fail!</p>
        <ul>
            <li>Press <code>Ctrl + Shift + R</code> (or <code>Ctrl + F5</code>) on the Driving Stats page</li>
            <li>Or open this page in Incognito mode</li>
            <li>Expected new JavaScript file: <code>index-DNYqnq40.js</code></li>
        </ul>
    </div>

    <div class="box">
        <h2>üîç Run Tests</h2>
        <button onclick="testAPI()">Test API Endpoints</button>
        <button onclick="checkBuild()">Check Build Files</button>
        <button onclick="runAll()">Run All Tests</button>
    </div>

    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `box ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }

        function clear() {
            document.getElementById('results').innerHTML = '';
        }

        async function testAPI() {
            clear();
            log('<h2>üîå Testing API Endpoints...</h2>');
            
            try {
                // Test Driving Stats API
                log('<h3>1. Testing Driving Game Endpoint</h3>');
                const drivingRes = await fetch(`${API_BASE}/api/leaderboard/?mode=driving_game&limit=5`);
                const drivingData = await drivingRes.json();
                const drivingTotal = drivingRes.headers.get('x-total-count');
                
                if (drivingTotal === '0' && drivingData.length === 0) {
                    log(`<strong>‚úÖ PASS:</strong> Driving game endpoint returns empty list<br>
                         Total: ${drivingTotal}, Entries: ${drivingData.length}`, 'success');
                } else {
                    log(`<strong>‚ùå FAIL:</strong> Driving game should be empty!<br>
                         Total: ${drivingTotal}, Entries: ${drivingData.length}<br>
                         <pre>${JSON.stringify(drivingData.slice(0, 2), null, 2)}</pre>`, 'error');
                }
                
                // Test Maze Leaderboard API
                log('<h3>2. Testing Maze Leaderboard Endpoint</h3>');
                const mazeRes = await fetch(`${API_BASE}/api/leaderboard/?mode=lam&limit=5`);
                const mazeData = await mazeRes.json();
                const mazeTotal = mazeRes.headers.get('x-total-count');
                
                if (mazeTotal > 0 && mazeData.length > 0) {
                    log(`<strong>‚úÖ PASS:</strong> Maze leaderboard returns data<br>
                         Total: ${mazeTotal}, Entries: ${mazeData.length}`, 'success');
                } else {
                    log(`<strong>‚ö†Ô∏è WARNING:</strong> Maze leaderboard seems empty<br>
                         Total: ${mazeTotal}`, 'warning');
                }
                
                // Check if maze data contaminated driving
                if (drivingData.length > 0 && drivingData[0].total_steps) {
                    log(`<strong>‚ùå CRITICAL:</strong> Maze game data found in driving endpoint!<br>
                         This means the separation failed.`, 'error');
                }
                
            } catch (err) {
                log(`<strong>‚ùå ERROR:</strong> ${err.message}<br>
                     Is backend running on port 8000?`, 'error');
            }
        }

        async function checkBuild() {
            clear();
            log('<h2>üì¶ Checking Build Files...</h2>');
            
            try {
                // Check if new build is loaded
                const scripts = Array.from(document.querySelectorAll('script[src]'));
                const hasNewBuild = scripts.some(s => s.src.includes('index-DNYqnq40'));
                const hasOldBuild = scripts.some(s => s.src.includes('index-BNRJSS--'));
                
                if (hasNewBuild) {
                    log('<strong>‚úÖ PASS:</strong> New build detected (index-DNYqnq40.js)', 'success');
                } else if (hasOldBuild) {
                    log(`<strong>‚ùå FAIL:</strong> Old build detected (index-BNRJSS--.js)<br>
                         <strong>Action:</strong> Press Ctrl+Shift+R to force reload!`, 'error');
                } else {
                    log('<strong>‚ÑπÔ∏è INFO:</strong> No build files detected (running from different page)', 'warning');
                }
                
                // Check localStorage for theme (indicates page loaded)
                const drivingTheme = localStorage.getItem('driving-game-theme');
                if (drivingTheme) {
                    log(`<strong>‚ÑπÔ∏è INFO:</strong> Driving Stats page has been visited<br>
                         Theme: ${drivingTheme}`, 'success');
                }
                
            } catch (err) {
                log(`<strong>‚ùå ERROR:</strong> ${err.message}`, 'error');
            }
        }

        async function runAll() {
            clear();
            await testAPI();
            await new Promise(r => setTimeout(r, 500));
            await checkBuild();
            
            log(`<h2>üìã Summary</h2>
                 <p>Check the results above. All tests should pass for the fix to be verified.</p>
                 <p><strong>Next Step:</strong> If tests pass, navigate to the Driving Stats page and hard refresh (Ctrl+Shift+R).</p>`, 
                'warning');
        }
    </script>
</body>
</html>

